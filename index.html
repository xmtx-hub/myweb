<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简乱码双向转换（含标点替换版）</title>
    <style>
        /* 基础样式 */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            padding: 15px;
            background-color: #f5f5f7;
            color: #333;
            line-height: 1.6;
        }
        
        h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        /* 电脑样式 */
        @media (min-width: 768px) {
            .container {
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background-color: white;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            }
            
            textarea {
                width: 100%;
                height: 180px;
                padding: 15px;
                font-size: 16px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                resize: vertical;
                margin-bottom: 20px;
                font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
                transition: border-color 0.3s;
            }
            
            textarea:focus {
                border-color: #3498db;
                outline: none;
            }
            
            .button-container {
                display: flex;
                gap: 15px;
                justify-content: center;
            }
            
            button {
                padding: 12px 32px;
                font-size: 16px;
                font-weight: 500;
                cursor: pointer;
                border: none;
                border-radius: 8px;
                transition: all 0.2s;
                min-width: 150px;
            }
            
            #toGarbledBtn {
                background-color: #3498db;
                color: white;
            }
            
            #toGarbledBtn:hover {
                background-color: #2980b9;
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
            }
            
            #toNormalBtn {
                background-color: #2ecc71;
                color: white;
            }
            
            #toNormalBtn:hover {
                background-color: #27ae60;
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);
            }
        }
        
        /* 手机样式 */
        @media (max-width: 767px) {
            .container {
                padding: 10px;
            }
            
            textarea {
                width: 100%;
                height: 140px;
                padding: 12px;
                font-size: 15px;
                border: 1px solid #ddd;
                border-radius: 6px;
                resize: vertical;
                margin-bottom: 15px;
                font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            }
            
            .button-container {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            button {
                padding: 14px 20px;
                font-size: 16px;
                font-weight: 500;
                cursor: pointer;
                border: none;
                border-radius: 8px;
                width: 100%;
            }
            
            #toGarbledBtn {
                background-color: #3498db;
                color: white;
            }
            
            #toNormalBtn {
                background-color: #2ecc71;
                color: white;
            }
            
            /* 手机触摸反馈 */
            button:active {
                transform: scale(0.98);
            }
        }
        
        /* 占位符样式 */
        textarea::placeholder {
            color: #999;
            opacity: 0.8;
        }
        
        /* 小提示 */
        .hint {
            text-align: center;
            font-size: 13px;
            color: #7f8c8d;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div class="container">
        <h3>普通文字 ↔ 乱码转换</h3>
        
        <textarea id="normalText" placeholder="输入普通文字，点击下方「转乱码」按钮"></textarea>
        <textarea id="garbledText" placeholder="输入生成的乱码，点击下方「转普通文字」按钮"></textarea>
        
        <div class="button-container">
            <button id="toGarbledBtn" onclick="toGarbled()">转 乱 码</button>
            <button id="toNormalBtn" onclick="toNormal()">转普通文字</button>
        </div>
        
        <div class="hint">
            支持中文、英文和标点符号的互相转换
        </div>
    </div>

    <script>
        const normalInput = document.getElementById('normalText');
        const garbledInput = document.getElementById('garbledText');
        
        // 更丰富的崩坏符号库
        const randomSymbols = [
            '・', '∽', '∝', '㈹', '', '､', '･', '╳', '〓', '￡', '￢', '￣', 
            '♂', '♀', '￤', '＄', '％', '＆', '＊', '＃', '！', '？', '；', '：',
            '「', '」', '『', '』', '（', '）', '｛', '｝', '【', '】', '￠', '￡',
            '△', '▽', '○', '□', '△', '￪', '￬', '↵', '↔', '♪', '♫', '☉', '★',
            '☆', '￤', '〒', '＠', '＝', '＋', '－', '／', '＼', '～', '｀', '´'
        ];
        
        // 常用标点与崩坏符号的映射表（转乱码时替换，还原时反向映射）
        const punctuationMap = {
            '，': '､',
            '。': '・',
            '？': '？',
            '！': '！',
            '；': '；',
            '：': '：',
            '“': '「',
            '”': '」',
            '‘': '｀',
            '’': '´',
            '（': '（',
            '）': '）',
            '、': '･',
            '…': '～～'
        };
        
        // 反向映射表（用于还原标点）
        const reversePunctuationMap = {};
        for (const [origin, replace] of Object.entries(punctuationMap)) {
            reversePunctuationMap[replace] = origin;
        }

        // 判断是否是我们插入的崩坏符号
        function isInsertedSymbol(char) {
            return randomSymbols.includes(char) && !Object.values(reversePunctuationMap).includes(char);
        }

        // 字符编码偏移转换
        function charTransform(char, isToGarbled) {
            const code = char.charCodeAt(0);
            if (code >= 0x4E00 && code <= 0x9FFF) { // 中文
                return String.fromCharCode(isToGarbled ? code + 1234 : code - 1234);
            } else if (code >= 0x0020 && code <= 0x007E) { // 英文/半角标点
                return String.fromCharCode(isToGarbled ? code + 6543 : code - 6543);
            } else {
                return char;
            }
        }

        // 替换常用标点为崩坏符号
        function replacePunctuation(char, isToGarbled) {
            if (isToGarbled) {
                return punctuationMap[char] || char;
            } else {
                return reversePunctuationMap[char] || char;
            }
        }

        // 生成随机间隔
        function getRandomInterval() {
            return Math.floor(Math.random() * 9) + 2;
        }

        // 获取随机符号
        function getRandomSymbol() {
            let symStr = '';
            const symCount = Math.floor(Math.random() * 2) + 1;
            for (let i = 0; i < symCount; i++) {
                const randomIndex = Math.floor(Math.random() * randomSymbols.length);
                symStr += randomSymbols[randomIndex];
            }
            return symStr;
        }

        // 普通文字转乱码
        function toGarbled() {
            const normalStr = normalInput.value;
            if (!normalStr.trim()) {
                garbledInput.value = '';
                return;
            }
            
            let garbledStr = '';
            let charCount = 0;
            let currentInterval = getRandomInterval();

            for (let i = 0; i < normalStr.length; i++) {
                let currentChar = normalStr[i];
                // 第一步：替换常用标点
                currentChar = replacePunctuation(currentChar, true);
                // 第二步：字符编码偏移转换
                currentChar = charTransform(currentChar, true);
                // 第三步：拼接转换后的字符
                garbledStr += currentChar;
                charCount++;

                // 达到间隔插入随机符号
                if (!Object.keys(punctuationMap).includes(normalStr[i]) && charCount >= currentInterval && i !== normalStr.length - 1) {
                    garbledStr += getRandomSymbol();
                    charCount = 0;
                    currentInterval = getRandomInterval();
                }
            }
            garbledInput.value = garbledStr;
        }

        // 乱码转普通文字
        function toNormal() {
            const garbledStr = garbledInput.value;
            if (!garbledStr.trim()) {
                normalInput.value = '';
                return;
            }
            
            let normalStr = '';

            // 第一步：过滤插入的崩坏符号
            let filteredStr = '';
            for (let i = 0; i < garbledStr.length; i++) {
                const char = garbledStr[i];
                if (!isInsertedSymbol(char)) {
                    filteredStr += char;
                }
            }

            // 第二步：先还原字符编码，再还原标点
            for (let i = 0; i < filteredStr.length; i++) {
                let currentChar = filteredStr[i];
                // 字符编码反向转换
                currentChar = charTransform(currentChar, false);
                // 标点反向还原
                currentChar = replacePunctuation(currentChar, false);
                normalStr += currentChar;
            }

            normalInput.value = normalStr;
        }
        
        // 添加键盘快捷键支持
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'Enter') {
                    if (document.activeElement === normalInput) {
                        toGarbled();
                    } else if (document.activeElement === garbledInput) {
                        toNormal();
                    }
                }
            }
        });
    </script>
</body>
</html>